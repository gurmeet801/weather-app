<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Weather App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen text-white antialiased">
    <div class="relative min-h-screen overflow-hidden">
      <div class="absolute inset-0">
        <div class="orb orb-one"></div>
        <div class="orb orb-two"></div>
        <div class="orb orb-three"></div>
        <div class="bg-grid"></div>
      </div>

      <main
        class="relative mx-auto flex w-full max-w-6xl flex-col gap-12 px-6 py-16 lg:flex-row lg:items-start"
      >
        <header class="flex-1 space-y-6 fade-up delay-1">
          <div class="grid gap-4 sm:grid-cols-2">
            <div class="glass-panel rounded-2xl p-4">
              <p class="text-xs uppercase tracking-[0.2em] text-white/60">
                Location
              </p>
              {% if forecast %}
                <p class="mt-2 text-lg font-semibold">
                  {{ forecast.location }}
                </p>
              {% else %}
                <p class="mt-2 text-lg font-semibold">Awaiting search</p>
              {% endif %}
              {% if resolved_location %}
                <p class="mt-2 text-xs text-white/60">
                  Search: {{ resolved_location }}
                </p>
              {% elif address %}
                <p class="mt-2 text-xs text-white/60">
                  Search: {{ address }}
                </p>
              {% endif %}
            </div>
            <div class="glass-panel rounded-2xl p-4">
              <p class="text-xs uppercase tracking-[0.2em] text-white/60">
                Search Mode
              </p>
              <p class="mt-2 text-lg font-semibold">{{ search_source }}</p>
            </div>
          </div>
          <p class="text-xs text-white/60">Data source: api.weather.gov</p>
        </header>

        <section
          class="glass-card w-full max-w-xl flex-1 rounded-3xl p-6 sm:p-8 fade-up delay-2"
        >
          <form method="get" class="grid gap-4">
            <div>
              <label for="address" class="text-sm font-medium text-white/70"
                >Search by address</label
              >
              <input
                id="address"
                name="address"
                type="text"
                autocomplete="street-address"
                value="{{ address }}"
                placeholder="1600 Pennsylvania Ave NW, Washington, DC"
                class="glass-input mt-2 w-full rounded-2xl px-4 py-2 text-sm"
              />
            </div>
            <div class="flex flex-col gap-3 sm:flex-row">
              <button
                class="btn-primary w-full rounded-2xl px-5 py-2 text-sm sm:w-auto"
                type="submit"
              >
                Search address
              </button>
              <button
                class="btn-secondary w-full rounded-2xl px-5 py-2 text-sm sm:w-auto"
                type="button"
                id="use-location"
              >
                Use my location
              </button>
            </div>
            <p
              id="location-status"
              class="text-xs text-white/70"
              aria-live="polite"
            ></p>
          </form>

          <div class="mt-6 space-y-4">
            {% if error %}
              <div
                class="glass-panel rounded-2xl border border-rose-200/40 bg-rose-500/10 p-4 text-rose-50"
              >
                <p class="text-sm font-medium">{{ error }}</p>
              </div>
            {% elif forecast %}
              <div class="glass-panel rounded-2xl p-5">
                <div
                  class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"
                >
                  <div>
                    <p class="text-sm text-white/70">
                      {{ forecast.location }}
                    </p>
                    <p class="text-4xl font-semibold">
                      {{ forecast.period.temperature }}°{{ forecast.period.temperatureUnit }}
                    </p>
                    <p class="text-sm text-white/70">
                      {{ forecast.period.shortForecast }}
                    </p>
                  </div>
                  <div class="text-left sm:text-right">
                    <p class="text-sm font-medium text-white">
                      {{ forecast.period.name }}
                    </p>
                    <p class="text-sm text-white/70">
                      Wind {{ forecast.period.windSpeed }} {{ forecast.period.windDirection }}
                    </p>
                    {% if forecast.next_period %}
                      <p class="text-sm text-white/70">
                        Next: {{ forecast.next_period.name }} ·
                        {{ forecast.next_period.temperature }}°{{ forecast.next_period.temperatureUnit }}
                        · {{ forecast.next_period.shortForecast }}
                      </p>
                    {% endif %}
                  </div>
                </div>
                <div class="my-4 h-px bg-white/15"></div>
                <p class="text-sm text-white/75">
                  {{ forecast.period.detailedForecast }}
                </p>
              </div>
            {% else %}
              <div class="glass-panel rounded-2xl p-4">
                <p class="text-sm text-white/70">
                  Search by address or use your current location to load the
                  latest forecast from api.weather.gov.
                </p>
              </div>
            {% endif %}
          </div>
        </section>
      </main>
    </div>
    <script>
      const locationButton = document.getElementById("use-location");
      const statusEl = document.getElementById("location-status");

      if (locationButton && statusEl) {
        const defaultLabel = locationButton.textContent;

        locationButton.addEventListener("click", () => {
          if (!navigator.geolocation) {
            statusEl.textContent = "Geolocation is not supported in this browser.";
            return;
          }

          locationButton.disabled = true;
          locationButton.textContent = "Locating...";
          statusEl.textContent = "Requesting your location...";

          navigator.geolocation.getCurrentPosition(
            (position) => {
              const lat = position.coords.latitude.toFixed(4);
              const lon = position.coords.longitude.toFixed(4);
              const params = new URLSearchParams({ lat, lon });
              window.location = `/?${params.toString()}`;
            },
            (error) => {
              locationButton.disabled = false;
              locationButton.textContent = defaultLabel;
              statusEl.textContent =
                error.message || "Unable to retrieve your location.";
            },
            {
              enableHighAccuracy: false,
              timeout: 10000,
              maximumAge: 60000,
            }
          );
        });
      }
    </script>
  </body>
</html>
