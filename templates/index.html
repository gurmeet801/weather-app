{% extends "base.html" %}

{% block content %}
<!-- Loading State -->
{% include "components/loading.html" %}

<!-- Permission Request -->
{% include "components/permission.html" %}

<!-- Weather Display -->
<div id="weather-state" class="fade-up {% if not forecast and not error %}hidden{% endif %}">
  <!-- Error Message -->
  {% include "components/error.html" %}

  {% if forecast %}
  <!-- Header with Location -->
  {% include "components/header.html" %}

  <!-- Alerts Banner -->
  {% include "components/alerts.html" %}

  <!-- Main Content Grid -->
  <div class="layout">
    <!-- Current Weather Card -->
    {% include "components/current_weather.html" %}

    <!-- Summary Card -->
    {% include "components/summary.html" %}

    <!-- Hourly Forecast -->
    {% include "components/hourly_forecast.html" %}

    <!-- 7-Day Forecast -->
    {% include "components/daily_forecast.html" %}
  </div>
  {% endif %}
</div>

<!-- Modals -->
{% include "components/location_modal.html" %}
{% include "components/switch_modal.html" %}
{% include "components/day_detail_modal.html" %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/weather.js', v=asset_version) }}"></script>
<script>
  // Initialize the weather app with server-side data
  const urlParams = new URLSearchParams(window.location.search);
  const addressParam = urlParams.get('address');
  const hasAddressParam = addressParam && addressParam.trim().length > 0;
  
  WeatherApp.init({
    hasWeatherData: {{ 'true' if forecast or error else 'false' }},
    hasLocationParams: (urlParams.has('lat') && urlParams.has('lon')) || hasAddressParam,
    currentLocationKey: {{ current_location_key | tojson }},
    timeZone: {{ forecast.time_zone | tojson if forecast else "null" }},
    dailyDetails: {{ forecast.daily_details | tojson if forecast else "[]" }},
  });

  // Apply dynamic weather background
  {% if forecast and forecast.period %}
  WeatherApp.applyWeatherTheme(
    '{{ forecast.period.shortForecast | e }}',
    {{ 'true' if forecast.period.isDaytime else 'false' }}
  );
  {% endif %}
</script>
{% endblock %}
