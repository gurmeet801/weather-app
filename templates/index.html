{% extends "base.html" %}

{% block content %}
<!-- Loading State -->
{% include "components/loading.html" %}

<!-- Permission Request -->
{% include "components/permission.html" %}

<!-- Weather Display -->
<div id="weather-state" class="fade-up {% if not forecast and not error %}hidden{% endif %}">
  <!-- Error Message -->
  {% include "components/error.html" %}

  {% if forecast %}
  <!-- Header with Location -->
  {% include "components/header.html" %}

  <!-- Alerts Banner -->
  {% include "components/alerts.html" %}

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
    <!-- Current Weather Card -->
    {% include "components/current_weather.html" %}

    <!-- Right Column -->
    <div class="lg:col-span-2 flex flex-col gap-4 sm:gap-6">
      <!-- Hourly Forecast -->
      {% include "components/hourly_forecast.html" %}

      <!-- 7-Day Forecast -->
      {% include "components/daily_forecast.html" %}
    </div>
  </div>
  {% endif %}
</div>

<!-- Modals -->
{% include "components/location_modal.html" %}
{% include "components/switch_modal.html" %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/weather.js') }}"></script>
<script>
  // Initialize the weather app with server-side data
  const urlParams = new URLSearchParams(window.location.search);
  const addressParam = urlParams.get('address');
  const hasAddressParam = addressParam && addressParam.trim().length > 0;
  
  WeatherApp.init({
    hasWeatherData: {{ 'true' if forecast or error else 'false' }},
    usedCachedLocation: {{ 'true' if used_cached_location else 'false' }},
    hasLocationParams: (urlParams.has('lat') && urlParams.has('lon')) || hasAddressParam,
  });
</script>
{% endblock %}
